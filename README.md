# Bucket

The Project is a **storage standard** applied to canisters.

Its goal is to become a general data storage standard on [Internet Computer](https://dfinity.org/) (IC). By using this standard, just **one line of import code**, developers can easily use data storage functions such as put, get when writing canister smart contracts on IC without repeating develop this aspect.

In order to be compatible with the existing development ecology, we develop two version standard:

- [Bucket](#Bucket)
- [Bucket-HTTP](#Bucket-HTTP)

You can use this just like using the TireMap.

<span id="Bucket"></span>

##  Bucket

- First, you need to import bucket in your project 

   ```motoko
   import Bucket "Bucket";
   ```

- Second, you need to declare a Bucket

   ```motoko
   let bucket = Bucket.Bucket();
   ```

**You can then call the API to use the corresponding function**

###  API

- Pass in the arguments p([PUT](#typesPUT)) and caller to upload the file chunk

  if success,return [AssetExt](#typesAssetExt)

  if fail,return [DataErr](#typesDataErr)

  ```motoko
  func put(p : PUT, caller : Principal) : Result.Result<AssetExt, DataErr>
  ```

- Pass in the argument g([GET](#typesGET)) to get the corresponding file

  if success,return a file chunk as Blob

  if fail,return[DataErr](#typesDataErr)

  ```motoko
  func get(g : GET) : Result.Result<Blob, DataErr>
  ```

- Get the current available memory

  Returns a Nat representing the currently available memory

  ```motoko
  func getAvailableStableMemory() : Nat
  ```

- Get meta information for all files

  return [AssetExt](#typesAssetExt) array

  ````
  public func getAssetExts(caller : Principal) : [AssetExt]
  ````

- Get meta information about a file

  if success,return [AssetExt](#typesAssetExt)

  if fail,return [DataErr](#typesDataErr)

  ```motoko
  func getAssetExtByKey(file_key : Text, caller : Principal) : Result.Result<AssetExt, DataErr>
  ```

- clear the Bucket

  return the information as Text

  ```motoko
  func clear() : Text
  ```

- save entries before update

  return the information as Text

  ```motoko
  func preUpgrade() : Text
  ```

###  Types

<span id="typesChunk"></span>
- Chunk

  ```motoko
      public type Chunk = {
          digest : [Nat8]; // the SHA256 of the data
          data : Blob; 
      };
  ```
  <span id="typesAsset"></span>  

- Asset

  ```motoko
      public type Asset = {
          file_key :  Text; 
          file_name : Text;
          file_extension : Text; // such like "jpg","mp3"
          total_size : Nat; // total file size
          page_field : [(Nat, Nat)]; // the location of the file,[(offset,size)],file -> [offset,offset+size)
      };
  ```
  <span id="typesAssetBuffer"></span>

- AssetBuffer

  ```motoko
      public type AssetBuffer = {
          chunk_number : Nat;
          total_size : Nat;
          digest : [var Nat8]; 
          read_page_field : [(Nat, Nat)];
          write_page_field : [[(Nat, Nat)]];
          wrote_page : [var Bool];
          var received : Nat; 
      };
  ```
  <span id="typesAssetExt"></span>

- AssetExt

  ```motoko
      public type AssetExt = {
          bucket_id : Principal; // canister where the file is located
          file_key : Text;
          file_name : Text;
          file_extension : Text;
          total_size : Nat;
          upload_status : Bool;
          need_query_times : Nat; // The number of queries needed to get the file
      };
  ```
  <span id="typesPUT"></span>

- PUT

  ```motoko
      public type PUT = {
          file_key : Text; // as the key of the map to search file,generated by front-end
          file_name : Text;
          file_extension : Text;
          chunk : Chunk;
          chunk_number : Nat; // the number of all chunks
          chunk_order : Nat; // the number of the current chunk
          total_size : Nat;
      };
  ```
  <span id="typesGET"></span>

- GET

  ```motoko
      public type GET = {
          file_key : Text; // the key of the map to search file
          flag : Nat; // as the chunk_order
      };
  ```
  <span id="typesDataErr"></span>

- DataErr

  ```motoko
      public type DataErr = {
          #MemoryInsufficient;
          #BlobSizeError;
          #FileKeyErr;
          #FlagErr;
      };
  ```

<span id="Bucket-HTTP"></span>

##  Bucket-HTTP

The difference between Bucket-HTTP and Bucket is that Bucket-HTTP has built-in **http_request**, so people can query files through **canisterID.raw.ic0.app/fk/file_key**

example

``bs5jn-2aaaa-aaaai-qhtaq-cai.raw.ic0.app/fk/8B091EE0CB685ABD376F7645A6A57E9E118671DF003444C1C13B37E2FCAFCEA7``

Due to the problem of IC mainnet, HTTP-StreamingCallback cannot work at present, so only files less than or equal to **3M** can be accessed through http.

We will fix this deficiency as soon as possible.

## Disclaimer

YOU EXPRESSLY ACKNOWLEDGE AND AGREE THAT USE OF THIS SOFTWARE IS AT YOUR SOLE RISK. AUTHORS OF THIS SOFTWARE SHALL NOT BE LIABLE FOR DAMAGES OF ANY TYPE, WHETHER DIRECT OR INDIRECT.

## Contributing

<span id="hh"></span>

We'd like to collaborate with the community to provide better data storage standard implementation for the developers on the IC, if you have some ideas you'd like to discuss, submit an issue, if you want to improve the code or you made a different implementation, make a pull request!